{% extends "base.html" %}

{% block title %}Certificate Verification | X University{% endblock %}

{% block body_class %}verification-body{% endblock %}

{% block navbar %}{% endblock %}

{% block content %}
{% if error %}
<!-- Error State -->
<div class="verification-card">
    <div class="verification-header">
        <div class="verification-icon invalid">‚úó</div>
        <h2 style="color: var(--danger-color); margin-bottom: var(--spacing-md);">Verification Failed</h2>
    </div>
    <p class="text-muted" style="margin-bottom: var(--spacing-lg);">{{ error }}</p>
    <p class="text-muted" style="font-size: 0.9rem;">If you believe this is an error, please contact the institution.
    </p>
</div>
{% else %}
<!-- Success State -->
<div class="verification-card">
    <div class="verification-header">
        <div class="verification-icon valid">‚úì</div>
        <h2 style="color: var(--success-color); margin-bottom: var(--spacing-md);">Certificate Verified</h2>
        <p class="text-muted">This certificate has been securely verified by the institution.</p>
    </div>

    <!-- Certificate Details -->
    <div class="verification-details">
        <div class="detail-row">
            <span class="detail-label">Student Name</span>
            <span class="detail-value">{{ activity.student.full_name }}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Institution ID</span>
            <span class="detail-value">{{ activity.student.institution_id }}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Activity Title</span>
            <span class="detail-value">{{ activity.title }}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Activity Type</span>
            <span class="detail-value">
                {% if activity.activity_type %}
                {{ activity.activity_type.name }}
                {% else %}
                {{ activity.custom_category }}
                {% endif %}
            </span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Activity Date</span>
            <span class="detail-value">{{ activity.start_date }}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Verified By</span>
            <span class="detail-value">
                {% if activity.status == 'auto_verified' %}
                System (Automated)
                {% elif activity.faculty %}
                {{ activity.faculty.full_name }}
                {% else %}
                Institution
                {% endif %}
            </span>
        </div>
    </div>

    <!-- Tamper-Proof Integrity -->
    <div class="hash-integrity">
        <h4>üîê Tamper-Proof Verification</h4>
        <p class="text-muted" style="margin-bottom: var(--spacing-md);">SHA-256 Digital Fingerprint</p>

        <div class="hash-value">{{ activity.certificate_hash }}</div>

        {% if recomputed_hash %}
        {% if hash_match %}
        <div class="integrity-check match">
            <span class="integrity-icon">‚úì</span>
            <div>
                <strong>Untampered</strong>
                <div style="font-size: 0.85rem; opacity: 0.9;">Hash verification successful</div>
            </div>
        </div>
        {% else %}
        <div class="integrity-check mismatch">
            <span class="integrity-icon">‚ö†</span>
            <div>
                <strong>Possible Tampering Detected</strong>
                <div style="font-size: 0.85rem; opacity: 0.9;">Hash mismatch - file may have been modified</div>
            </div>
        </div>
        <details style="margin-top: var(--spacing-md);">
            <summary style="cursor: pointer; color: var(--primary-color); font-weight: 600;">View comparison</summary>
            <div style="margin-top: var(--spacing-md);">
                <div style="font-size: 0.8rem;">
                    <div><strong>Expected Hash:</strong></div>
                    <div style="font-family: var(--font-mono); word-break: break-all; color: var(--text-gray);">{{
                        activity.certificate_hash }}</div>
                </div>
                <div style="font-size: 0.8rem; margin-top: var(--spacing-md);">
                    <div><strong>Actual Hash:</strong></div>
                    <div style="font-family: var(--font-mono); word-break: break-all; color: var(--text-gray);">{{
                        recomputed_hash }}</div>
                </div>
            </div>
        </details>
        {% endif %}
        {% else %}
        <div class="integrity-check unknown">
            <span class="integrity-icon">?</span>
            <div>
                <strong>Cannot Verify File</strong>
                <div style="font-size: 0.85rem; opacity: 0.9;">Original file not found for comparison</div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endif %}
{% endblock %}