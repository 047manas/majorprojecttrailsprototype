<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Activity Types - Admin</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .activity-form {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            align-items: end;
            /* Align inputs to bottom */
        }

        @media (max-width: 768px) {
            .activity-form {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>

    <div class="container">
        <header style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h1>Activity Types</h1>
                <p class="text-muted">Define activities and assign the Faculty In-Charge.</p>
            </div>
            <div>
                <a href="{{ url_for('admin_users') }}" class="btn btn-outline-primary"
                    style="margin-right: 0.5rem;">Manage Users</a>
                <a href="{{ url_for('admin_naac_dashboard') }}" class="btn btn-outline-primary"
                    style="margin-right: 0.5rem;">NAAC Dashboard</a>
                <a href="{{ url_for('logout') }}" class="btn btn-danger" style="margin-left: 0.5rem;">Logout</a>
            </div>
        </header>

        {% with messages = get_flashed_messages() %}
        {% if messages %}
        <div class="alert alert-success">
            {% for message in messages %}
            <div>{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        <div class="card">
            <div class="card-header">Add New Activity Type</div>
            <div class="card-body">
                <form action="{{ url_for('admin_activity_types') }}" method="post">
                    <div class="activity-form">
                        <div class="form-group">
                            <label>Activity Name <small class="text-muted d-block">Unique name</small></label>
                            <input type="text" name="name" class="form-control" required
                                placeholder="e.g. Technical Workshop">
                        </div>

                        <div class="form-group">
                            <label>Faculty In-Charge <small class="text-muted d-block">Verifies these
                                    requests</small></label>
                            <select name="faculty_id" class="form-control" required>
                                <option value="" disabled selected>Select In-Charge...</option>
                                {% for fac in faculty_users %}
                                <option value="{{ fac.id }}">{{ fac.full_name }} ({{ fac.department or 'No Dept' }}, {{
                                    fac.institution_id or 'No ID' }})</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Description <small class="text-muted d-block">Optional details</small></label>
                            <input type="text" name="description" class="form-control" placeholder="Short description">
                        </div>
                    </div>

                    <div style="margin-top: 1rem;">
                        <button type="submit" class="btn btn-success">Add Activity Type</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="card">
            <div class="card-header">Existing Activity Types</div>
            <div class="card-body">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Faculty In-Charge</th>
                            <th>Description</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for at in activity_types %}
                        <tr>
                            <td>{{ at.name }}</td>
                            <td>
                                {% if at.faculty_incharge %}
                                <strong>{{ at.faculty_incharge.full_name }}</strong> <br>
                                <small class="text-muted">{{ at.faculty_incharge.department }} ({{
                                    at.faculty_incharge.institution_id }})</small>
                                {% else %}
                                <span class="badge bg-danger">Unassigned</span>
                                {% endif %}
                            </td>
                            <td>{{ at.description or '-' }}</td>
                            <td>
                                <div style="display: flex; gap: 0.5rem;">
                                    <a href="{{ url_for('admin_edit_activity_type', at_id=at.id) }}"
                                        class="btn btn-sm btn-outline-primary">Edit</a>
                                    <form action="{{ url_for('admin_delete_activity_type', at_id=at.id) }}"
                                        method="post" onsubmit="return confirm('Delete this activity type?');">
                                        <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="4" class="text-muted text-center">No activity types defined yet.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

    </div>

</body>

</html>